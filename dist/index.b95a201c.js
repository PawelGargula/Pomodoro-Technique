function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class t extends Audio{play3Times(){this.play();let e=1;this.onended=function(){e<3&&(e++,this.play())}}constructor(...t){super(...t),e(this,"name","alarm"),e(this,"path",`sound/${this.name}.flac`),e(this,"db",{name:"audios_db",objectStore:{name:"audios_os",keyPath:"name",indexName:"flacBlob",record:{name:this.name,flacBlob:null}}})}}const n=new t("");let a;const s=window.indexedDB.open(n.db.name,1);function i(e){const t=URL.createObjectURL(e);n.src=t}s.addEventListener("error",(()=>console.error("Database failed to open"))),s.addEventListener("success",(()=>{console.log("Database opened successfully"),a=s.result,function(){const e=a.transaction(n.db.objectStore.name).objectStore(n.db.objectStore.name).get(n.name);e.addEventListener("success",(()=>{e.result?(console.log("Taking audio from IDB"),i(e.result[n.db.objectStore.indexName])):(console.log("Fetching audio from network"),fetch(n.path).then((e=>e.blob())).then((e=>{i(e),function(e){const t=a.transaction(n.db.objectStore.name,"readwrite").objectStore(n.db.objectStore.name);n.db.objectStore.record.flacBlob=e;const s=n.db.objectStore.record,i=t.add(s);i.addEventListener("success",(()=>console.log("Record additon attempt finished"))),i.addEventListener("error",(()=>console.error(i.error)))}(e)})))}))}()})),s.addEventListener("upgradeneeded",(e=>{e.target.result.createObjectStore(n.db.objectStore.name,{keyPath:n.db.objectStore.keyPath}).createIndex(n.db.objectStore.indexName,n.db.objectStore.indexName,{unique:!1}),console.log("Database setup complete")}));const o={handle:document.getElementById("message"),writingNow:!1,erasingNow:!1,animationSpeed:90,hiddenMessageHandle:document.querySelector("#hidden-message"),show(e){if(e<4){const e="Time for short break (3 to 5min)";this.write(e)}else{const e="Time for long break (15 to 30min)";this.write(e)}},write(e){document.title=e,this.hiddenMessageHandle.innerText=e,this.handle.innerHTML="",this.writingNow=!0,[...e].forEach(((t,n)=>{setTimeout((()=>{this.handle.innerHTML+=t,this.handle.innerHTML===e&&(this.writingNow=!1)}),n*this.animationSpeed)}))},erase(){if(this.hiddenMessageHandle.innerText="",!this.erasingNow&&""!==this.handle.innerHTML){this.erasingNow=!0;let e=setInterval((()=>{this.writingNow||(this.handle.innerHTML=this.handle.innerHTML.slice(0,-1)),""===this.handle.innerHTML&&(clearInterval(e),this.erasingNow=!1)}),this.animationSpeed)}}},r={handle:document.getElementById("counter"),update(){this.value>=4?this.handle.innerText="Counter: 1":this.handle.innerText=`Counter: ${this.value+1}`},get value(){let e=this.handle.innerText.replace("Counter: ","");return e=parseInt(e,10),isNaN(e)||e<1||minutes>4?1:e}},l={handle:document.getElementById("start-stop"),updateToStop(){this.handle.className="stop",this.handle.innerText="Stop",this.handle.ariaLabel="Stop the timer"},updateToStart(){this.handle.className="start",this.handle.innerText="Start",this.handle.ariaLabel="Start the timer"}},d={handle:document.getElementById("seconds"),countToMiliseconds(){return 1e3*this.value},get value(){let e=parseInt(this.handle.innerText,10);return isNaN(e)||e<0||e>59?0:e},countToClockSeconds:e=>Math.floor(e%6e4/1e3),update(e){this.handle.innerText=e.toString().padStart(2,"0")}},c={handle:document.getElementById("minutes"),countToMiliseconds(){return 6e4*this.value},get value(){let e=parseInt(this.handle.innerText,10);return isNaN(e)||e<0||e>99?25:e},countToClockMinutes:e=>Math.floor(e/6e4),update(e){this.handle.innerText=e.toString().padStart(2,"0")}},h={handle:document.getElementById("clock"),updateAriaLabel(e,t){this.handle.ariaLabel=`${e} minutes and ${t} seconds remaining`}};let u={minutesKey:"minutes",getMinutes(){if(!m())return 25;let e=localStorage.getItem(this.minutesKey);return null===e?25:Number(e)},setMinutes(e){m()&&localStorage.setItem(this.minutesKey,e)}};function m(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}}const p={minutesFromUser:u.getMinutes(),timerInterval:null,stopped:!0,startOrStop(){this.stopped?this.start():this.stop()},start(){this.stopped=!1,l.updateToStop(),o.erase();let e=this.now+c.countToMiliseconds()+d.countToMiliseconds()+30;this.timerInterval=setInterval((()=>this.update(e)),1e3)},get now(){return(new Date).getTime()},update(e){let t=e-this.now;this.updateClock(t),this.updatePageTitle(),t<1&&(this.reset(),n.play3Times(),o.show(r.value),r.update())},updateClock(e){let t=d.countToClockSeconds(e);d.update(t);let n=c.countToClockMinutes(e);c.update(n),h.updateAriaLabel(n,t)},updatePageTitle(){document.title=`${h.handle.innerText} - Pomodoro Timer`},reset(){c.update(this.minutesFromUser),d.update(0),h.updateAriaLabel(this.minutesFromUser,0),this.stop(),this.updatePageTitle()},stop(){this.stopped=!0,clearInterval(this.timerInterval),l.updateToStart()},set(){let e=prompt("Enter minutes (1 to 99)",this.minutesFromUser);null!==e&&(e=parseInt(e,10),isNaN(e)||e<1||e>99?alert("Wrong number, must be between 1 and 99"):(this.minutesFromUser=e,u.setMinutes(e),this.reset()))}},g={handle:document.getElementById("reset")};c.update(p.minutesFromUser),h.updateAriaLabel(p.minutesFromUser,0),l.handle.addEventListener("click",(()=>p.startOrStop())),g.handle.addEventListener("click",(()=>p.reset())),h.handle.addEventListener("click",(()=>p.set()));(async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register(`${location.href}sw.js`);e.installing?console.log("Service worker installing"):e.waiting?console.log("Service worker installed"):e.active&&console.log("Service worker active")}catch(e){console.error(`Registration failed with ${e}`)}})();
//# sourceMappingURL=index.b95a201c.js.map
